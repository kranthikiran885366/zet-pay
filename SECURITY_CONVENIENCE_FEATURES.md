
# Zet Pay Super App: Security & Convenience Features Documentation

This document outlines various security enhancements and convenience features designed to protect users and improve their experience within the Zet Pay application.

## 1. Introduction

Zet Pay prioritizes user security and aims to provide a trustworthy platform. Beyond standard security practices, several unique features are conceptualized or implemented to offer advanced protection and convenience.

## 2. Core Security Architecture (Referenced from README.md)

Zet Pay's foundational security relies on:
-   **Firebase Authentication:** Secure user login via phone OTP.
-   **HTTPS/SSL/TLS:** Encryption for all data in transit.
-   **Firestore Security Rules:** Granular access control for database operations.
-   **Backend API Authentication:** All sensitive backend API calls require a verified Firebase ID token (handled by `authMiddleware.js`).
-   **Input Validation:** Both client-side and server-side validation of user inputs.
-   **Secure Partner Integrations:** (Conceptual) Secure methods for interacting with PSPs, payment gateways, and other third-party services.
-   **Regular Audits & VAPT:** (Process) Standard industry practice for identifying and mitigating vulnerabilities.

## 3. Unique Security & Convenience Features

### 3.1. Secure Vault
-   **Functionality:** Allows users to securely store digital copies of important documents like tickets, bills, insurance policies, ID cards, etc.
-   **Implementation:**
    -   Frontend: `/src/app/(features)/vault/page.tsx` provides UI for uploading, viewing, and managing vaulted items.
    -   Backend:
        -   Routes: `/api/vault/*`.
        -   Controller: `vaultController.js`.
        -   Service: `vaultService.js`.
    -   **Storage:** Files are uploaded to **Firebase Storage** under a user-specific path (e.g., `user_vault_files/{userId}/`). Metadata (name, type, source, storage path) is stored in the `vaultItems` Firestore collection.
    -   **Security:** Firebase Storage provides server-side encryption. For enhanced security, client-side encryption before upload could be considered (conceptual). Access to files is controlled by Firestore security rules and backend checks.
    -   **File Upload:** Can support direct client-to-Storage uploads using signed URLs (generated by backend) or backend-proxied uploads.

### 3.2. Emergency Mode
-   **Functionality:** A one-tap feature to quickly initiate emergency actions: share current location (with consent), call pre-defined emergency contacts or services (e.g., 108/100), and potentially prepare the wallet for quick emergency payments.
-   **Implementation:**
    -   Frontend: `/src/app/emergency/page.tsx`. UI to activate emergency mode and display status of actions.
    -   Backend:
        -   A conceptual endpoint `POST /api/user/emergency-action` could:
            *   Log the emergency event.
            *   If location sharing is consented to and a trusted contact system exists, simulate sending location.
            *   (Client-side initiates the `tel:` call for emergency numbers).
            *   Set a flag on the user's profile or wallet for "emergency payment priority" (conceptual).
    -   **Location Services:** Uses browser `navigator.geolocation`.
    -   **Call Initiation:** Uses `tel:` URI scheme.

### 3.3. Payment Freeze Mode (Conceptual)
-   **Functionality:** Allows users to temporarily freeze all payment capabilities from their Zet Pay account in case of suspected unauthorized access or a lost device.
-   **Implementation:**
    -   Frontend: A toggle in Profile > Security Settings.
    -   Backend: A flag in the `users/{userId}` document (e.g., `isPaymentFrozen: true`). All payment-initiating backend services (`upiController.js`, `walletController.js`, `rechargeController.js`, etc.) would need to check this flag before processing a payment.
    -   **Re-activation:** Would require strong re-authentication (e.g., OTP + security questions).

### 3.4. Smart Wallet Bridge (UPI Limit Fallback)
-   **Functionality:** If a UPI payment fails due to bank limits, and the user has enabled this feature (KYC verified), Zet Pay attempts the payment using the user's Zet Pay Wallet balance (up to a user-set limit). The amount is then auto-recovered from the user's bank account later.
-   **Implementation:** Documented in `UPI_WALLET_FEATURES.md`.
    -   Frontend: Setting in `/src/app/(features)/profile/security/smart-wallet-limit/page.tsx`.
    -   Backend: Logic in `upiController.js` and `recoveryService.ts`.
    -   Firestore: `users/{userId}` for settings, `recoveryTasks` for scheduled recovery.

### 3.5. Auto-Credit for Failed-but-Debited Payments (Conceptual)
-   **Functionality:** If a payment fails but the user's account is debited, Zet Pay can (based on webhook notifications from PSP or internal reconciliation) automatically create a support ticket and provide a temporary credit to the user's Zet Pay wallet if the refund from the bank/biller is delayed beyond a certain period.
-   **Implementation:**
    -   Backend:
        -   Webhook listener for PSP notifications (e.g., `/api/webhooks/psp`).
        -   `paymentController.js` or a dedicated `refundService.js` to handle logic.
        -   This service would:
            *   Identify relevant failed-but-debited transactions.
            *   Create a support ticket in Firestore (`supportTickets` collection).
            *   After a configurable delay (e.g., T+2 days), if no refund confirmation is received, credit the user's wallet using `payViaWalletInternal` (with a negative amount for credit).
            *   Log this credit transaction.
    -   **Transaction Logging:** The temporary credit is logged.

### 3.6. QR Code Security Features
-   **Functionality:**
    -   **Validation:** Backend validation of scanned QR codes against known malicious patterns, blacklisted UPI IDs, and reported QRs.
    -   **Verified Merchants:** Displaying a "Verified Merchant" badge for known, trusted payees.
    -   **Reporting:** Allowing users to report suspicious QR codes.
    -   **Stealth Scan Mode (Conceptual):** Scan QR codes discreetly without full camera preview, potentially with haptic feedback.
-   **Implementation:**
    -   Frontend: `/src/app/(features)/scan/page.tsx`.
    -   Backend: `scanController.js`, `scanService.js`.
    -   Firestore: `verified_merchants`, `blacklisted_qrs`, `reported_qrs`.

### 3.7. 24/7 Live Human Support Chat
-   **Functionality:** Users can initiate a live chat session with a support agent for assistance.
-   **Implementation:**
    -   Frontend: `/src/app/(features)/support/page.tsx` using `ZetChat` component.
    -   Backend:
        -   WebSocket server in `server.js` manages connections.
        -   `chatService.js` handles message routing and storage (conceptually, needs integration with an agent dashboard system).
    -   Firestore: `chats` and `chats/{chatId}/messages` collections.

## 4. General Security Measures

-   **Rate Limiting:** Applied to backend APIs to prevent abuse (`express-rate-limit` in `server.js`).
-   **Security Headers:** Using `helmet` middleware in `server.js`.
-   **Session Management:** Firebase Authentication handles secure session management client-side. Backend verifies ID tokens.
-   **Secure Local Storage (Client):** Firebase SDK manages its token storage. Other sensitive app data avoided in `localStorage`.
-   **App Integrity Checks (Conceptual - Firebase App Check):** Can be integrated to protect backend resources from abuse by unverified clients.

These features, combined with robust standard security practices, contribute to a safer and more convenient user experience on Zet Pay.

